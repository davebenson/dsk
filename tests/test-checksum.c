#include "../dsk.h"
#include <string.h>

typedef struct _HashSumTest HashSumTest;
struct _HashSumTest
{
  const char *str;
  char md5[16];
  char sha1[20];
  char sha256[32];
  char sha512[64];
};

static HashSumTest tests[] =
{
  {
    "a",
    { 0x0c, 0xc1, 0x75, 0xb9, 0xc0, 0xf1, 0xb6, 0xa8,
      0x31, 0xc3, 0x99, 0xe2, 0x69, 0x77, 0x26, 0x61 },
    { 0x86, 0xf7, 0xe4, 0x37, 0xfa, 0xa5, 0xa7, 0xfc,
      0xe1, 0x5d, 0x1d, 0xdc, 0xb9, 0xea, 0xea, 0xea,
      0x37, 0x76, 0x67, 0xb8 },
    { 0xca, 0x97, 0x81, 0x12, 0xca, 0x1b, 0xbd, 0xca,
      0xfa, 0xc2, 0x31, 0xb3, 0x9a, 0x23, 0xdc, 0x4d,
      0xa7, 0x86, 0xef, 0xf8, 0x14, 0x7c, 0x4e, 0x72,
      0xb9, 0x80, 0x77, 0x85, 0xaf, 0xee, 0x48, 0xbb },
    { 0x1f, 0x40, 0xfc, 0x92, 0xda, 0x24, 0x16, 0x94,
      0x75, 0x09, 0x79, 0xee, 0x6c, 0xf5, 0x82, 0xf2,
      0xd5, 0xd7, 0xd2, 0x8e, 0x18, 0x33, 0x5d, 0xe0,
      0x5a, 0xbc, 0x54, 0xd0, 0x56, 0x0e, 0x0f, 0x53,
      0x02, 0x86, 0x0c, 0x65, 0x2b, 0xf0, 0x8d, 0x56,
      0x02, 0x52, 0xaa, 0x5e, 0x74, 0x21, 0x05, 0x46,
      0xf3, 0x69, 0xfb, 0xbb, 0xce, 0x8c, 0x12, 0xcf,
      0xc7, 0x95, 0x7b, 0x26, 0x52, 0xfe, 0x9a, 0x75 }

  }
};
#define TEST_COUNT		DSK_N_ELEMENTS(tests)

int main ()
{
  DskChecksum *h;
  unsigned i;
  for (i = 0; i < TEST_COUNT; i++)
    {
      uint8_t buf[64];

      h = dsk_checksum_new (&dsk_checksum_type_md5);
      dsk_checksum_feed_str (h, tests[i].str);
      dsk_checksum_done (h);
      dsk_checksum_get (h, buf);
      dsk_assert (memcmp (buf, tests[i].md5, 16) == 0);
      dsk_checksum_destroy (h);

      h = dsk_checksum_new (&dsk_checksum_type_sha1);
      dsk_checksum_feed_str (h, tests[i].str);
      dsk_checksum_done (h);
      dsk_checksum_get (h, buf);
      dsk_assert (memcmp (buf, tests[i].sha1, 20) == 0);
      dsk_checksum_destroy (h);

      h = dsk_checksum_new (&dsk_checksum_type_sha256);
      dsk_checksum_feed_str (h, tests[i].str);
      dsk_checksum_done (h);
      dsk_checksum_get (h, buf);
      dsk_assert (memcmp (buf, tests[i].sha256, 32) == 0);
      dsk_checksum_destroy (h);

      h = dsk_checksum_new (&dsk_checksum_type_sha512);
      dsk_checksum_feed_str (h, tests[i].str);
      dsk_checksum_done (h);
      dsk_checksum_get (h, buf);
      dsk_assert (memcmp (buf, tests[i].sha512, 64) == 0);
      dsk_checksum_destroy (h);
    }
  return 0;
}

